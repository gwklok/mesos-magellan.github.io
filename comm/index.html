<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">

	<title>Communication - Magellan</title>

        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../css/highlight.css">
        <link href="../css/base.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="..">Magellan</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li >
                    <a href="..">Home</a>
                </li>
            
            
            
                <li >
                    <a href="../components/">Components</a>
                </li>
            
            
            
                <li class="active">
                    <a href="./">Communication</a>
                </li>
            
            
            
                <li >
                    <a href="../demo/">Demo</a>
                </li>
            
            
            
                <li >
                    <a href="../guide/">Guides</a>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                <li >
                    <a rel="next" href="../components/">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../demo/">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#communication">Communication</a></li>
        
            <li><a href="#the-scheduler-api-schema">The Scheduler API Schema</a></li>
        
            <li><a href="#job-creation-to-executor">Job Creation to Executor</a></li>
        
            <li><a href="#executor-to-problem">Executor to Problem</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<h1 id="communication">Communication</h1>
<p>Description of the communication between the different components of the Magellan Mesos Framework.</p>
<h2 id="the-scheduler-api-schema">The Scheduler API Schema</h2>
<p>The following REST API schema is used by the Web UI to communicate with the scheduler back end.</p>
<h3 id="post-apijob">POST /api/job</h3>
<p>Create a new job</p>
<p><strong>Request</strong></p>
<pre><code class="json">{
    &quot;job_name&quot; : &quot;Solve 99 Problems&quot;,
    &quot;job_time&quot; : 3600,
    &quot;module_url&quot; : &quot;git@github.com:mesos-magellan/faleiro.git&quot;,
    &quot;module_data&quot; : {
        &quot;problem_size&quot; : 99,
        &quot;expected_solution&quot; : 0,
        &quot;anything_i_want&quot; : {
            &quot;all_my_things&quot; : [
                &quot;cat&quot;,
                4096,
                &quot;dogs&quot;,
                &quot;foo&quot;
            ]
        }
    }
}
</code></pre>

<p><strong>Response (200)</strong></p>
<pre><code class="json">{
    &quot;job_id&quot; : 42
}
</code></pre>

<p><strong>Response (422)</strong></p>
<pre><code class="json">{
    &quot;message&quot; : &quot;A parameter is missing&quot;
}
</code></pre>

<p><strong>Response (500)</strong></p>
<pre><code class="json">{
    &quot;message&quot; : &quot;Failed to create job&quot;
}
</code></pre>

<h3 id="put-apijobjob_idstatus">PUT /api/job/{job_id}/status</h3>
<p>Set the status of an existing job</p>
<p><strong>Parameters</strong></p>
<p><code>{job_id}</code> : <em>ID of the job to modify</em></p>
<p><strong>Request</strong></p>
<pre><code class="json">{
    &quot;status&quot; : &quot;resume&quot; /* or &quot;stop&quot; or &quot;pause&quot; */
}
</code></pre>

<p><strong>Response (200)</strong></p>
<pre><code class="json">{
}
</code></pre>

<p><strong>Response (422)</strong></p>
<pre><code class="json">{
    &quot;message&quot; : &quot;A parameter is missing&quot;
}
</code></pre>

<h3 id="get-apijobs">GET /api/jobs</h3>
<p>Get all the jobs</p>
<p><strong>Request</strong></p>
<pre><code class="json">{
}
</code></pre>

<p><strong>Response (200)</strong></p>
<pre><code class="json">{
    [
        {
            &quot;job_id&quot; : 42,
            &quot;job_name&quot; : &quot;Solve 99 Problems&quot;,
            &quot;job_starting_time&quot; : 112385801,
            &quot;task_name&quot; : &quot;git@github.com:mesos-magellan/faleiro.git&quot;,
            &quot;task_seconds&quot; : 500,
            &quot;current_state&quot; : &quot;RUNNING&quot;,
            &quot;best_location&quot; : &quot;{ \&quot;path\&quot; : \&quot;SUJENAGHWOPQ\&quot; }&quot;,
            &quot;best_energy&quot; : 400.5,
            &quot;num_finished_tasks&quot; : 91,
            &quot;num_total_tasks&quot; : 99,
            &quot;energy_history&quot; : [
                0.2,
                400.5,
                10.122
            ],
            &quot;additional_params&quot; : {
                &quot;start&quot; : {
                    &quot;X&quot; : 356,
                    &quot;name&quot; : &quot;foo&quot;
                }
            }
        },
        {
            &quot;job_id&quot; : 47,
            &quot;job_name&quot; : &quot;Solve All Problems&quot;,
            &quot;job_starting_time&quot; : 112385801,
            &quot;task_name&quot; : &quot;git@github.com:mesos-magellan/faleiro.git&quot;,
            &quot;task_seconds&quot; : 600,
            &quot;current_state&quot; : &quot;STOP&quot;,
            &quot;best_location&quot; : &quot;{ \&quot;index\&quot; : 2345093 }&quot;,
            &quot;best_energy&quot; : 12039454,
            &quot;num_finished_tasks&quot; : 42,
            &quot;num_total_tasks&quot; : 123,
            &quot;energy_history&quot; : [
                947345,
                3302,
                12039454
            ],
            &quot;additional_params&quot; : {
                &quot;start&quot; : {
                    &quot;X&quot; : 50,
                    &quot;name&quot; : &quot;hello world&quot;
                }
            }
        }
    ]
}
</code></pre>

<h3 id="get-apijobjob_id">GET /api/job/{job_id}</h3>
<p>Get a specific job by job_id</p>
<p><strong>Parameters</strong></p>
<p><code>{job_id}</code> : <em>ID of the job to retrieve</em></p>
<p><strong>Request</strong></p>
<pre><code class="json">{
}
</code></pre>

<p><strong>Response (200) - No longer running</strong><br />
<strong>Response (202) - Job still running</strong></p>
<pre><code class="json">{
    &quot;job_id&quot; : 47,
    &quot;job_name&quot; : &quot;Solve All Problems&quot;,
    &quot;job_starting_time&quot; : 112385801,
    &quot;task_name&quot; : &quot;git@github.com:mesos-magellan/faleiro.git&quot;,
    &quot;task_seconds&quot; : 600,
    &quot;current_state&quot; : &quot;STOP&quot;,
    &quot;best_location&quot; : &quot;{ \&quot;index\&quot; : 2345093 }&quot;,
    &quot;best_energy&quot; : 12039454,
    &quot;num_finished_tasks&quot; : 42,
    &quot;num_total_tasks&quot; : 123,
    &quot;energy_history&quot; : [
        947345,
        3302,
        12039454
    ],
    &quot;additional_params&quot; : {
        &quot;start&quot; : {
            &quot;X&quot; : 50,
            &quot;name&quot; : &quot;hello world&quot;
        }
    }
}
</code></pre>

<p><strong>Response (422)</strong></p>
<pre><code class="json">{
    &quot;message&quot; : &quot;A parameter is missing&quot;
}
</code></pre>

<h2 id="job-creation-to-executor">Job Creation to Executor</h2>
<h3 id="client-starts-job">Client Starts Job</h3>
<p>The client starts a job using the command line interface. Using the CLI, they can specify the parameters for their job. The full list of parameters can be found on the Web API page. After creating a job on the command line client, the request is sent to the Web API using http.</p>
<h3 id="the-web-api">The Web API</h3>
<p>The web api handles the request from the CLI and forwards this request to the MagellanFramework using the function call <code>MagellanFramework::createJob()</code>. </p>
<h3 id="the-magellan-framework">The Magellan Framework</h3>
<p>Internally, the Magellan Framework constructs a MagellanJob object. A MagellanJob, at a high level, represents all data and state corresponding to a problem that the client wants to solve. The MagellanJob breaks this problem into subproblems called tasks which are run on executors. An instance of the Magellan Framework can have multiple instances of MagellanJob with each instance having several tasks associated with it that can be run in parallel.  After creating the MagellanJob object, the framework calls <code>MagellanJob::start()</code> which executes the main function of the Job, called <code>MagellanJob::run()</code>, in a separate thread. </p>
<p>A MagellanJob is responsible for partioning the search space of the problem and creating tasks which run on executors and report their results back to the job. MagellanJobs are restricted to creating 10 active tasks at a time to ensure that this system scales well when a lot of jobs are submitted simultaneously. New tasks are submitted to a BlockingQueue called <code>pendingTasks</code>. This object holds ready tasks until the MagellanFramework requests them using the method <code>MagellanJob::getPendingTasks()</code>. After executing tasks, the results are returned to the Job to be processed using the method, <code>MagellanJob::processIncomingMessages()</code>. </p>
<p>The scheduler sends the following JSON string to the executor as part of the tasks payload: </p>
<pre><code>{
    # required
    &quot;uid&quot;:
    &quot;name&quot;:
    &quot;command&quot;:
    &quot;problem_data&quot;:
    # for 'divisions' command
    &quot;divisions&quot;:
    # for 'anneal' command
    &quot;sstates&quot;:
    &quot;minutes_per_division&quot;:
}
</code></pre>

<p>As you can see, each task only sends a unique identifier for the task, the starting location for the simulated annealing (SA) algorithm, the name of the SA implementation we want to use to execute the task, how long the task should take and additional parameters passed in by the client as arguments.  The  initial temperature, cooling rate and number of iterations per change in temperature that are detrimental to the SA algorithm are not given and are all chosen on the executor side. See the executor document for details.</p>
<p>The MagellanFramework then uses Fenzo to determine how tasks will be scheduled and then uses the Mesos Driver to schedule the tasks. See the Scheduler docs for more details.</p>
<p>The response from the executor is the following JSON string:</p>
<pre><code>{
    &quot;uid&quot;:
    # for anneal
    &quot;best_location&quot;:
    &quot;fitness_score&quot;:
    # for divisions
    &quot;divisions&quot;:
}
</code></pre>

<p>This JSON string cotains the unique identifier for the task, the best solution it discovered, and the fitness or energy score of the best solution. This data is passed to and processed by the MagellanJob from which it originated.  If the energy of this data is better than the global best energy, then we update our global best fitness value and location value. Currently, new tasks start their searches with the global best values but by the final product, we hope to implement a meta annealing scheduler where the scheduler itself performs simulated annealing to choose starting locations for new tasks.</p>
<p>In case of a failed task, the following body will be returned with a TASK_FAILED status:</p>
<pre><code>{
    &quot;error&quot;: &lt;stacktrace&gt;
}
</code></pre>

<h2 id="executor-to-problem">Executor to Problem</h2>
<h3 id="problem-definition">Problem Definition</h3>
<p>Clients can provide problems to be solved by providing implementations of the Problem definition from the Magellan pyrallelsa package.</p>
<h3 id="executor-execution">Executor Execution</h3>
<p>When the client creates a job they will provide a URL (either to a git respository or a gzip archive) of the problem definition. The executor will then pull and cache the archive on the agent. It will import and use the Problem defined in the downloaded package.</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            
            <center>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</center>
        </footer>

        <script src="../js/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/highlight.pack.js"></script>
        <script>var base_url = '..';</script>
        <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>
        <script src="../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>